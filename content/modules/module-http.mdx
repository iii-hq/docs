---
title: 'HTTP'
description: 'Expose functions as HTTP endpoints.'
---

The HTTP Module exposes registered functions as HTTP endpoints.

```
modules::api::RestApiModule
```

## Sample Configuration

```yaml
- class: modules::api::RestApiModule
  config:
    port: 3111
    host: 0.0.0.0
    cors:
      allowed_origins:
        - http://localhost:3000
        - http://localhost:5173
      allowed_methods:
        - GET
        - POST
        - PUT
        - DELETE
        - OPTIONS
```

## Configuration

<ResponseField name="port" type="number">
  The port to listen on. Defaults to `3111`.
</ResponseField>

<ResponseField name="host" type="string">
  The host to listen on. Defaults to `0.0.0.0`.
</ResponseField>

<ResponseField name="default_timeout" type="number">
  The default timeout in milliseconds for request processing. Defaults to `30000`.
</ResponseField>

<ResponseField name="concurrency_request_limit" type="number">
  The maximum number of concurrent requests the server will handle. Defaults to `1024`.
</ResponseField>

<ResponseField name="cors" type="Cors">
  The CORS configuration.

  <Expandable title="Cors">
    <ResponseField name="allowed_origins" type="string[]" required>
      The allowed origins.
    </ResponseField>
    <ResponseField name="allowed_methods" type="string[]" required>
      The allowed methods.
    </ResponseField>
  </Expandable>
</ResponseField>

## Trigger Type

This module adds a new Trigger Type: `http`.

<Expandable title="Trigger Config">
  <ResponseField name="api_path" type="string" required>
    The path of the API.
  </ResponseField>
  <ResponseField name="http_method" type="string" required>
    The HTTP method of the API.
  </ResponseField>
  <ResponseField name="_condition_path" type="string">
    Function ID for conditional execution. The engine invokes it with the request; if it returns `false`, the handler function is not called.
  </ResponseField>
</Expandable>

### Sample code

```typescript
const fn = iii.registerFunction({ id: 'api.getUsers' }, handler)
iii.registerTrigger({
  type: 'http',
  function_id: fn.id,
  config: {
    api_path: '/api/v1/users',
    http_method: 'GET',
  },
})
```

## Request & Response Objects

### ApiRequest

When an API trigger fires, the function receives an `ApiRequest` object:

<ResponseField name="path" type="string">
  The request path.
</ResponseField>

<ResponseField name="method" type="string">
  The HTTP method of the request (e.g., `GET`, `POST`).
</ResponseField>

<ResponseField name="path_params" type="Record&lt;string, string&gt;">
  Variables extracted from the URL path (e.g., `/users/:id`).
</ResponseField>

<ResponseField name="query_params" type="Record&lt;string, string | string[]&gt;">
  URL query string parameters.
</ResponseField>

<ResponseField name="body" type="any">
  The parsed request body (JSON).
</ResponseField>

<ResponseField name="headers" type="Record&lt;string, string | string[]&gt;">
  HTTP request headers.
</ResponseField>

### ApiResponse

Functions must return an `ApiResponse` object:

<ResponseField name="status_code" type="number">
  HTTP status code (e.g., 200, 404, 500).
</ResponseField>

<ResponseField name="body" type="any">
  The response payload.
</ResponseField>

<ResponseField name="headers" type="string[]">
  HTTP response headers (optional).
</ResponseField>

## Request Lifecycle

```mermaid
sequenceDiagram
    participant Client
    participant Engine
    participant Worker

    Client->>+Engine: HTTP Request (GET /users/123)
    Note over Engine: Match route<br/>in registry
    Engine->>+Worker: Invoke Function (JSON)
    Note over Worker: Execute handler

    Worker-->>-Engine: Return {status_code, body, headers}
    Engine-->>-Client: HTTP Response
```

## Example Handler

```typescript
import { init } from 'iii-sdk'
import type { ApiRequest, ApiResponse } from 'iii-sdk'

const iii = init('ws://localhost:49134')

async function getUser(req: ApiRequest): Promise<ApiResponse> {
  const userId = req.path_params?.id
  const user = await database.findUser(userId)
  return {
    status_code: 200,
    body: { user },
    headers: { 'Content-Type': 'application/json' },
  }
}

const fn = iii.registerFunction({ id: 'api.getUser' }, getUser)
iii.registerTrigger({
  type: 'http',
  function_id: fn.id,
  config: {
    api_path: '/users/:id',
    http_method: 'GET',
  },
})
```
